<div class="viewWholesalersMain">
  <div class="appLayoutHeader">
    <div class="appLayoutHeaderText d-flex gap-2 align-items-center p-2">
      <div>
        <button nbButton size="small"
                (click)="backToPrev()"
                nbTooltip="Back to previous page" nbTooltipPlacement="bottom"
                class="rounded-2 fw-semibold">
          <nb-icon icon="arrow-back-outline"></nb-icon>
        </button>
      </div>
      <h5 class="fw-semibold m-0">Add Wholesalers
        <nb-icon nbPrefix icon="info-outline" class="cursor-pointer-npk" nbTooltip="Make sure to add the wholesalers. Data should be unique mainly email, phone number and alternative phone number" nbTooltipPlacement="bottom"></nb-icon>
      </h5>
    </div>
  </div>
  <div class="appLayoutBody">
    <div class="addWholesalers" *ngIf="loading">
      <form [formGroup]="wholesalersForm">
        <div formArrayName="wholesalers">
          <div *ngFor="let ws of wholesalers.controls; let i = index" [formGroupName]="i" class="card mb-3 border-0 p-4">
            <div class="row">
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Name*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="person-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" fullWidth
                         formControlName="name"
                         placeholder="Name"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('name')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('name')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('name')?.errors?.['required']">Please enter the name.</div>
                  <div *ngIf="ws.get('name')?.errors?.['pattern']">Name is not valid.</div>
                  <div *ngIf="ws.get('name')?.errors?.['minlength']">Name must be at least 3 characters.</div>
                  <div *ngIf="ws.get('name')?.errors?.['maxlength']">Name must be at most 20 characters.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Email*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="email-outline" pack="eva"></nb-icon>
                  <input type="email" nbInput class="form-control" fullWidth
                         formControlName="email"
                         placeholder="Email"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('email')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('email')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('email')?.errors?.['required']">Please enter the email.</div>
                  <div *ngIf="ws.get('email')?.errors?.['email']">Email is not valid.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Phone Number*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="phone-outline" pack="eva"></nb-icon>
                  <input type="tel" nbInput class="form-control" fullWidth
                         formControlName="phone"
                         placeholder="Phone Number"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('phone')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('phone')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('phone')?.errors?.['required']">Please enter the phone number.</div>
                  <div *ngIf="ws.get('phone')?.errors?.['pattern']">Please enter a valid 10-digit Phone Number starting with 6, 7, 8, or 9.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Alternative Number*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="phone-outline" pack="eva"></nb-icon>
                  <input type="tel" nbInput class="form-control" fullWidth
                         formControlName="alternatePhone"
                         placeholder="Alternative Phone Number"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('alternatePhone')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('alternatePhone')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('alternatePhone')?.errors?.['required']">Please enter the alternative phone number.</div>
                  <div *ngIf="ws.get('alternatePhone')?.errors?.['pattern']">Please enter a valid 10-digit Phone Number starting with 6, 7, 8, or 9.</div>
                </div>
                <div *ngIf="ws.get('phone')?.value && ws.errors?.['phoneNumbersShouldNotMatch']" class="small text-danger">
                  Phone Number and Alternative Phone Number cannot be the same.
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Website</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="browser-outline" pack="eva"></nb-icon>
                  <input type="url" nbInput class="form-control" fullWidth
                         formControlName="website"
                         placeholder="Website"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('website')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('website')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('website')?.errors?.['required']">Please enter the website.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Shop Name*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="home-outline" pack="eva"></nb-icon>
                  <input type="url" nbInput class="form-control" fullWidth
                         formControlName="shopName"
                         placeholder="Shop Name"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('shopName')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('shopName')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('shopName')?.errors?.['required']">Please enter the shop name.</div>
                  <div *ngIf="ws.get('shopName')?.errors?.['pattern']">Shop Name is not valid.</div>
                  <div *ngIf="ws.get('shopName')?.errors?.['minlength']">Shop Name must be at least 3 characters.</div>
                  <div *ngIf="ws.get('shopName')?.errors?.['maxlength']">Shop Name must be at most 50 characters.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler GST Number*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="clipboard-outline" pack="eva"></nb-icon>
                  <input type="url" nbInput class="form-control" fullWidth
                         formControlName="gstNumber"
                         placeholder="GST Number"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('gstNumber')?.errors }"
                         (keyup)="ws.get('gstNumber')?.value ? ws.get('gstNumber')?.setValue(ws.get('gstNumber')?.value.toUpperCase()) : ws.get('gstNumber')?.setValue(ws.get('gstNumber')?.value)">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('gstNumber')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('gstNumber')?.errors?.['required']">Please enter the GST Number.</div>
                  <div *ngIf="ws.get('gstNumber')?.errors?.['pattern']">Format 27ABCDE1234F1Z5.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler PAN Number*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="clipboard-outline" pack="eva"></nb-icon>
                  <input type="url" nbInput class="form-control" fullWidth
                         formControlName="panNumber"
                         placeholder="PAN Number"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('panNumber')?.errors }"
                         (keyup)="ws.get('panNumber')?.value ? ws.get('panNumber')?.setValue(ws.get('panNumber')?.value.toUpperCase()) : ws.get('panNumber')?.setValue(ws.get('panNumber')?.value)">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('panNumber')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('panNumber')?.errors?.['required']">Please enter the PAN Number.</div>
                  <div *ngIf="ws.get('panNumber')?.errors?.['pattern']">Format ABCDE1234F.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 mb-3">
                <label class="label fw-semibold">Bank Name*</label>
                <nb-form-field>
                  <nb-icon nbPrefix icon="code-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" fullWidth
                         formControlName="bankName"
                         placeholder="Bank Name"
                         (keyup)="ws.get('bankName')?.value ? ws.get('bankName')?.setValue(ws.get('bankName')?.value.toUpperCase()) : ws.get('bankName')?.setValue(ws.get('bankName')?.value)"
                          (input)="trimLeadingSpace($event)"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('bankName')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('bankName')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('bankName')?.errors?.['required']">
                    Please enter the bank name.
                  </div>
                  <div *ngIf="ws.get('bankName')?.errors?.['minlength']">
                    Bank name must be at least 3 characters.
                  </div>
                  <div *ngIf="ws.get('bankName')?.errors?.['maxlength']">
                    Bank name cannot exceed 50 characters.
                  </div>
                  <div *ngIf="ws.get('bankName')?.errors?.['pattern']">
                    Bank name can only contain letters and spaces.
                  </div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Bank Account Number*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="credit-card-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" fullWidth
                         formControlName="bankAccountNumber"
                         placeholder="Bank Account Number"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('bankAccountNumber')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('bankAccountNumber')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('bankAccountNumber')?.errors?.['required']">Please enter the bank account number.</div>
                  <div *ngIf="ws.get('bankAccountNumber')?.errors?.['pattern']">Please enter a valid bank account number (9-18 digits).</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">IFSC Code*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="keypad-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" fullWidth
                         formControlName="IFSCCode"
                         placeholder="IFSC Code"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('IFSCCode')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('IFSCCode')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('IFSCCode')?.errors?.['required']">Please enter the IFSC code.</div>
                  <div *ngIf="ws.get('IFSCCode')?.errors?.['pattern']">Please enter a valid IFSC code (e.g., SBIN0001234).</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Country*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="globe-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" formControlName="country" placeholder="Country"
                         (keyup)="trimLeadingSpace($event)" fullWidth
                         [ngClass]="{ 'is-invalid': submitted && ws.get('country')?.errors }"
                         [ngbTypeahead]="countrySearch"
                         [inputFormatter]="countryFormatter"
                         [resultFormatter]="countryFormatter"
                         [editable]='true'
                         [readOnly]="ws.get('country_id')?.value"
                         (selectItem)="countrySelected($event.item, ws)">
                  <nb-icon [hidden]="!ws.get('country')?.value"
                           (click)="resetCountry(ws, i)"
                           nbSuffix class="cursor-pointer-npk cursor-pointer" icon="refresh-outline" pack="eva"></nb-icon>
                </nb-form-field>
                <div *ngIf="submitted && ws.get('country')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('country')?.errors?.['required']">Please enter the country.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">State*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="pin-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" formControlName="state" placeholder="State"
                         (keyup)="trimLeadingSpace($event)" fullWidth
                         [ngClass]="{ 'is-invalid': submitted && ws.get('state')?.errors }"
                         [ngbTypeahead]="stateSearch"
                         [inputFormatter]="stateFormatter"
                         [resultFormatter]="stateFormatter"
                         [editable]='true'
                         [readOnly]="ws.get('state_id')?.value"
                         (selectItem)="stateSelected($event.item, ws)">
                  <nb-icon [hidden]="!ws.get('state')?.value"
                           (click)="resetState(ws, i)"
                           nbSuffix class="cursor-pointer-npk cursor-pointer" icon="refresh-outline" pack="eva"></nb-icon>
                </nb-form-field>
                <div *ngIf="submitted && ws.get('state')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('state')?.errors?.['required']">Please enter the state.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">City*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="map-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" fullWidth
                         formControlName="city"
                         placeholder="City"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('city')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('city')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('city')?.errors?.['required']">Please enter the city.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">PIN/ZIP Code*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="compass-outline" pack="eva"></nb-icon>
                  <input type="text" nbInput class="form-control" fullWidth
                         formControlName="zipCode"
                         placeholder="Zip Code"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('zipCode')?.errors }">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('zipCode')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('zipCode')?.errors?.['required']">Please enter the zip code.</div>
                  <div *ngIf="ws.get('zipCode')?.errors?.['pattern']">Please enter a valid 6-digit Zip Code.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Wholesaler Image*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="image-outline" pack="eva"></nb-icon>
                  <input type="file" nbInput class="form-control" [multiple]="false"
                         fullWidth accept="image/jpeg, image/png, image/jpg"
                         (change)="onFileChange($event, ws, i)"
                         placeholder="Upload picture">
                </nb-form-field>
                <div *ngIf="submitted && ws.get('images')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('images')?.errors?.['required']">Please upload an image.</div>
                </div>
              </div>
              <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 mb-3">
                <label class="label fw-semibold">Current Status*</label>
                <nb-form-field>
                  <nb-icon nbPrefix class="cursor-pointer-npk" icon="clipboard-outline" pack="eva"></nb-icon>
                  <nb-select fullWidth formControlName="status" placeholder="Status"
                             [ngClass]="{ 'is-invalid': submitted && ws.get('status')?.errors }">
                    <nb-option value="ACTIVE">Active</nb-option>
                    <nb-option value="INACTIVE">Inactive</nb-option>
                    <nb-option value="HOLD">Hold</nb-option>
                    <nb-option value="TERMINATED">Terminated</nb-option>
                  </nb-select>
                </nb-form-field>
                <div *ngIf="submitted && ws.get('status')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('status')?.errors?.['required']">Please select a status.</div>
                </div>
              </div>
              <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12 mb-3">
                <label class="label fw-semibold">Wholesaler Shop Address*</label>
               <textarea type="text" nbInput class="form-control" fullWidth
                         formControlName="address"
                         placeholder="Address"
                         [ngClass]="{ 'is-invalid': submitted && ws.get('address')?.errors }"></textarea>
                <div *ngIf="submitted && ws.get('address')?.errors" class="small text-danger">
                  <div *ngIf="ws.get('address')?.errors?.['required']">Please enter the address.</div>
                  <div *ngIf="ws.get('address')?.errors?.['pattern']">Address Name is not valid.</div>
                  <div *ngIf="ws.get('address')?.errors?.['minlength']">Address Name must be at least 3 characters.</div>
                  <div *ngIf="ws.get('address')?.errors?.['maxlength']">Address Name must be at most 100 characters.</div>
                </div>
              </div>
              <div class="col-12 py-0 text-center">
                <button nbButton status="danger"
                        *ngIf="wholesalers.controls.length > 1"
                        (click)="removeWholesaler(i)" size="small"
                        nbTooltip="You are deleting the wholesaler form {{ i + 1 }} of {{ws.get('name')?.value || 'Wholesaler'}}" nbTooltipPlacement="right"
                        class="rounded-2 fw-semibold"> Delete
                  <nb-icon icon="trash-outline"></nb-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="mt-3 d-flex justify-content-end">
        <button nbButton class="bg-black text-white d-none" size="small" (click)="addWholesaler()" type="button">+ Wholesaler</button>
        <div class="d-flex gap-3">
          <button nbButton class="bg-transparent "
                  (click)="backToPrev()" size="small"
                  [nbTooltip]="'Cancel and go back to previous page. If you cancel, you will lost the data.'" type="button" style="border: 1px solid black !important;">Cancel</button>
          <button nbButton class="bg-black text-white" size="small"
                  type="button" (click)="saveWholesalers()">Save</button>
        </div>
      </div>
    </div>
  </div>
</div>
